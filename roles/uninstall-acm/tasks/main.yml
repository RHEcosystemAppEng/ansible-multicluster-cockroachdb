---

# - name: Remove operator group in hub namespace
#   community.kubernetes.k8s:
#     state: absent
#     namespace: hub
#     definition:
#       apiVersion: operators.coreos.com/v1
#       kind: OperatorGroup
#       metadata:
#         name: hub-operator-group
#       spec:
#         targetNamespaces: 
#         - "hub"

# - name: Remove ACM operator subscription
#   community.kubernetes.k8s:
#     state: absent
#     namespace: hub
#     definition:
#       apiVersion: operators.coreos.com/v1alpha1
#       kind: Subscription
#       metadata:
#         name: acm-operator-subscription
#       spec:
#         sourceNamespace: openshift-marketplace
#         source: redhat-operators
#         channel: release-2.3
#         installPlanApproval: Automatic
#         name: advanced-cluster-management
  
- name: Remove MultiClusterHub custom resource
  community.kubernetes.k8s:
    state: absent
    namespace: hub
    definition:
      apiVersion: operator.open-cluster-management.io/v1
      kind: MultiClusterHub
      metadata:
        name: multiclusterhub
        namespace: hub
      spec:
# Check this before final
        imagePullSecret: acm-test01-pull-secret

- name: Delete Hub namespace objects
  shell: |
    /usr/local/bin/kubectl delete deploy,sa,svc,pvc,pod,cm,secret --all -n hub
- name: Delete Hub namespace
  shell: |
    /usr/local/bin/kubectl delete ns hub
- name: Delete CRDs
  shell: |
    /usr/local/bin/kubectl get crd | grep open-cluster-management.io | awk '{print $1}' | xargs /usr/local/bin/kubectl delete crd 